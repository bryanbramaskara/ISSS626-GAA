---
title: "Hands On Exercise 1.2"
format: html
---

## Hands On Exercisee 1.2 - Thematic Mapping and GeoVisualisation with R

```{r}

#| Loading the necessary libraries

pacman::p_load(sf, tmap, tidyverse, rvest)

#| Read the important data sets of URA MasterPlan2019SubzoneBoundaryNoSea in KML format

mpsz <- st_read("data/geospatial/MasterPlan2019SubzoneBoundaryNoSeaKML.kml")

#| Tidying KML data with newly created function  

extract_kml_field <- function(html_text, field_name) {
  if(is.na(html_text) || html_text == "") return(NA_character_)
  
  page <- read_html(html_text)
  rows <- page |> html_elements("tr")
  
  value <- rows |>
    keep(~ html_text2(html_element(.x, "th")) == field_name) |> 
    html_element("td") |> 
    html_text2()
  
  if (length(value) == 0) NA_character_ else value
}

mpsz <- mpsz |> 
  mutate(
    REGION_N = map_chr(Description, extract_kml_field, "REGION_N"),
    PLN_AREA_N = map_chr(Description, extract_kml_field, "PLN_AREA_N"),
    SUBZONE_N = map_chr(Description, extract_kml_field, "SUBZONE_N"),
    SUBZONE_C = map_chr(Description, extract_kml_field, "SUBZONE_C")
  ) |> 
  select(-Name, -Description) |> 
  relocate(geometry, .after = last_col())

mpsz

```

